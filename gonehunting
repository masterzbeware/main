-- âœ… Obsidian UI Setup
local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()

local Window = Library:CreateWindow({
    Title = "Hunting & Fishing Hub",
    Footer = "v4.0",
    Icon = 0,
    ShowCustomCursor = true,
})

local Tabs = {
    Main = Window:AddTab("Main", "sword")
}

-- âœ… Services & Remotes
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RemoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents")

-- Hunting
local CaptureAnimal        = RemoteEvents:WaitForChild("CaptureAnimal")
local MinigameFinished     = RemoteEvents:WaitForChild("MinigameFinished")
local RunAnimalHitParticle = RemoteEvents:WaitForChild("RunAnimalHitParticle")
local LogCustomEvent       = RemoteEvents:WaitForChild("LogCustomEvent")
local FireGun              = RemoteEvents:WaitForChild("FireGun")
local ToggleItemLock       = RemoteEvents:WaitForChild("ToggleItemLock")
local SellItem             = RemoteEvents:WaitForChild("SellItem")

-- Fishing
local CleanFishingLine     = RemoteEvents:WaitForChild("CleanFishingLine")
local FishCaught           = RemoteEvents:WaitForChild("FishCaught")
local RunFishingBubbles    = RemoteEvents:WaitForChild("RunFishingBubbles")
local RunFishingLine       = RemoteEvents:WaitForChild("RunFishingLine")

local AnimalsFolder = game.Workspace:WaitForChild("Animals")
local RunService    = game:GetService("RunService")

-- âœ… Config
local shootDir = Vector3.new(-0.61, 0.08, 0.78)

-- âœ… Toggle states
local autoHunt    = false
local autoLock    = false
local autoSell    = false
local autoFishing = false

-- âœ… Hunting Function
local function HuntTarget(model)
    if not autoHunt then return end

    local targetId = model.Name
    local mutation = model:GetAttribute("Mutation") or "None"
    local pos = model.PrimaryPart and model.PrimaryPart.Position or Vector3.zero

    -- tembak
    FireGun:FireServer(pos, shootDir, targetId)
    task.wait(0.2)

    RunAnimalHitParticle:FireServer("Perfect", targetId)
    LogCustomEvent:FireServer("HitPerfect")
    task.wait(0.2)

    MinigameFinished:FireServer(true)
    task.wait(0.2)

    CaptureAnimal:FireServer(tonumber(targetId))
    print("[AutoHunt] Tangkap:", targetId, "Mutation:", mutation)

    task.wait(0.5) -- tunggu item masuk inventory

    if mutation ~= "None" then
        if autoLock then
            ToggleItemLock:FireServer(targetId)
            print("[AutoHunt] Mutation "..mutation.." â†’ AUTO LOCK âœ…")
        end
    else
        if autoSell then
            SellItem:FireServer("All")
            print("[AutoHunt] Mutation None â†’ AUTO SELL ðŸ’°")
        end
    end
end

-- âœ… Auto Fishing Function
local function AutoFishRound()
    if not autoFishing then return end

    RunFishingBubbles:FireServer()
    task.wait(0.3)

    RunFishingLine:FireServer(0.65)
    task.wait(0.5)

    FishCaught:FireServer()
    task.wait(0.2)

    CleanFishingLine:FireServer()
    print("[AutoFishing] Selesai 1x mancing")
end

-- âœ… Loop Hunting
RunService.Heartbeat:Connect(function()
    if autoHunt then
        for _, model in ipairs(AnimalsFolder:GetChildren()) do
            if model:IsA("Model") then
                HuntTarget(model)
                task.wait(0.5)
            end
        end
    end
end)

-- âœ… Loop Fishing
task.spawn(function()
    while true do
        if autoFishing then
            AutoFishRound()
            task.wait(1)
        else
            task.wait(0.5)
        end
    end
end)

-- âœ… UI
local GroupBox = Tabs.Main:AddLeftGroupbox("Automation")

GroupBox:AddToggle("AutoHuntToggle", {
    Text = "Auto Hunt (Tangkap Semua)",
    Default = false,
    Callback = function(v)
        autoHunt = v
        Library:Notify("Auto Hunt: "..tostring(v), 3)
    end
})

GroupBox:AddToggle("AutoLockToggle", {
    Text = "Auto Lock Mutation",
    Default = false,
    Callback = function(v)
        autoLock = v
        Library:Notify("Auto Lock: "..tostring(v), 3)
    end
})

GroupBox:AddToggle("AutoSellToggle", {
    Text = "Auto Sell (Mutation None)",
    Default = false,
    Callback = function(v)
        autoSell = v
        Library:Notify("Auto Sell: "..tostring(v), 3)
    end
})

GroupBox:AddToggle("AutoFishingToggle", {
    Text = "Auto Fishing",
    Default = false,
    Callback = function(v)
        autoFishing = v
        Library:Notify("Auto Fishing: "..tostring(v), 3)
    end
})
